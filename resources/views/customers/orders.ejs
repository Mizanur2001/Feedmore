<section class="orders light-section py-8 sm:py-12 bg-[#F8F8F8]">
    <div class="container mx-auto px-2 sm:px-4">
        <h1 class="font-bold text-xl sm:text-2xl mb-6 sm:mb-8">Past Orders</h1>
        <% if (orders.length !==0) { %>
            <% orders.forEach(order=> { %>
                <div class="bg-white rounded-lg shadow p-4 sm:p-6 mb-6 sm:mb-8 flex flex-col gap-4">
                    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 flex-wrap">
                        <div class="flex flex-col sm:flex-row sm:items-center gap-4 w-full md:w-auto">
                            <!-- Multiple Item Images as Squares, overlapping -->
                            <div class="flex relative mb-2 sm:mb-0 flex-wrap">
                                <% Object.keys(order.items).forEach((itemId, idx)=> {
                                    const itemObj = order.items[itemId];
                                    const zIndex = 10 - idx;
                                    %>
                                    <img src="/img/<%= itemObj.items.image %>" alt="<%= itemObj.items.name %>"
                                        class="w-16 h-16 sm:w-20 md:w-24 md:h-24 object-cover rounded-lg border border-gray-200 shadow
                                        <% if(idx !== 0) { %> -ml-6 sm:-ml-6 md:-ml-8 <% } %> transition-all duration-300" {style="z-index:<%= zIndex %>;" } />
                                    <% }) %>
                            </div>
                            <div class="flex-1 min-w-[180px]">
                                <h2 class="font-bold text-base sm:text-xl md:text-2xl break-words">
                                    <%= Object.values(order.items).map(i=> i.items.name).join(', ') %>
                                </h2>
                                <p class="text-gray-500 text-sm sm:text-base">
                                    <%= order.address.split(',')[0] %>
                                </p>
                                <p class="text-xs sm:text-sm text-gray-400">
                                    ORDER #<%= order._id %>
                                </p>
                                <a href="/customers/orders/<%= order._id %>"
                                    class="text-orange-600 font-semibold mt-2 inline-block text-xs sm:text-base">VIEW
                                    DETAILS</a>
                            </div>
                        </div>
                        <div class="text-left md:text-right w-full md:w-auto mt-2 md:mt-0">
                            <p class="text-gray-600 font-semibold text-xs sm:text-base">
                                Ordered on <%= order.orderTime %>
                            </p>
                            <span
                                class="inline-flex items-center px-2 py-1 bg-green-100 text-green-600 rounded-full text-xs sm:text-sm font-bold mt-1">
                                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M5 13l4 4L19 7" />
                                </svg>
                                <%= order.status.toUpperCase() %>
                            </span>
                            <span
                                class="inline-flex items-center px-2 py-1 rounded-full text-xs sm:text-sm font-bold mt-2
                                <% if(order.paymentType.toUpperCase() === 'COD'){ %> bg-yellow-100 text-yellow-700 <% } else { %> bg-green-100 text-green-600 <% } %>">
                                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <rect x="3" y="7" width="18" height="10" rx="2" stroke-width="2" />
                                    <circle cx="12" cy="12" r="3" stroke-width="2" />
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M7 7v2M17 7v2M7 17v-2M17 17v-2" />
                                </svg>
                                <%= order.paymentType.toUpperCase() %>
                            </span>
                        </div>
                    </div>
                    <hr />
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-2">
                        <div>
                            <% Object.keys(order.items).forEach(itemId=> { %>
                                <% const itemObj=order.items[itemId]; %>
                                    <div class="text-base sm:text-lg">
                                        <%= itemObj.items.name %> x <%= itemObj.qty %>
                                    </div>
                                    <% }) %>
                        </div>
                        <div class="font-bold text-base sm:text-lg text-gray-700 mt-2 md:mt-0">
                            Total Paid: â‚¹ <%= Object.values(order.items).reduce((sum, itemObj)=> sum +
                                itemObj.items.price * itemObj.qty, 0) %>
                        </div>
                    </div>
                    <div class="flex flex-col md:flex-row gap-2 md:gap-4 mt-4">
                        <button
                            class="bg-orange-600 text-white px-4 py-2 rounded font-semibold hover:bg-orange-700 text-xs sm:text-base"
                            onclick="{window.location.href='/'}">REORDER</button>
                        <button
                            class="border border-orange-600 text-orange-600 px-4 py-2 rounded font-semibold hover:bg-orange-50 text-xs sm:text-base"
                            onclick="{window.location.href='tel:+917872727290'}">HELP</button>
                    </div>
                </div>
                <% }) %>
                    <% } else { %>
                        <div class="bg-white p-8 rounded shadow text-center text-gray-500">
                            No orders found!
                        </div>
                        <% } %>
    </div>
</section>