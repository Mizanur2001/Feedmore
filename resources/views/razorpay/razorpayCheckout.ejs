<section>
    <h1>Razorpay Payment Gateway Integration</h1>
    <form id="payment-form">
        <label for="amount">Amount:</label>
        <input type="number" id="amount" name="amount" required>
        <button type="button" onclick="payNow()">Pay Now</button>
    </form>

    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <script>
        async function payNow() {
            const amount = document.getElementById('amount').value;

            // Create order by calling the server endpoint
            const response = await fetch('/api/v1/tools/payment/customers/razorpay/initiate', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ amountInPaise: amount * 100, currency: 'INR', receipt: 'receipt#1', notes: {} })
            });

            const order = await response.json();

            console.log(order.data.order.id);


            // Open Razorpay Checkout
            var options = {
                key: "<%= process.env.RAZORPAY_KEY %>",
                amount: amount * 100,
                currency: "INR",
                name: "Mizanur Payments",
                description: "Invoice Payment",
                image: "https://mizanur.in/static/media/logo_me.a69395c0d314b1e15781.png",
                order_id: order.data.order.id,
                handler: async function (response) {
                    try {
                        const body = {
                            ...response,
                        };

                        const validateRes = await fetch("/api/v1/tools/payment/customers/razorpay/verify",
                            {
                                method: "POST",
                                headers: {
                                    "Content-Type": "application/json",
                                },
                                body: JSON.stringify(body),
                            }
                        );

                        const jsonRes = await validateRes.json();
                        console.log(jsonRes);
                        if (jsonRes.status) {
                            window.location.href = "/"
                        }
                    } catch (error) {
                        alert("Unable to verify payment. Please contact support.");
                    }
                },
                prefill: {
                    name: "Test User",
                    email: "test@feedmore.in",
                    contact: "9999999999",
                },
                notes: {
                    address: "Mizanur Office for now :)",
                },
                theme: {
                    color: "#3399cc",
                },
            };

            var rzp1 = new window.Razorpay(options);

            rzp1.on("payment.failed", function () {
                alert("Payment failed, please try again :(")
            });

            rzp1.open();
        }
    </script>

</section>